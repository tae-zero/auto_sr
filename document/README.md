# 🏢 기업개요 데이터 업로더

`기업개요.csv` 파일을 Railway PostgreSQL 데이터베이스에 업로드하는 Python 스크립트입니다.

## 📋 기능

- CSV 파일 자동 읽기 및 파싱
- PostgreSQL 데이터베이스 연결
- 자동 테이블 생성 및 인덱스 설정
- 데이터 전처리 (날짜 변환, 빈 값 처리)
- 기존 데이터 관리 (삭제 또는 추가)
- 업로드 결과 확인 및 샘플 데이터 표시

## 🚀 설치 및 실행

### 1. 의존성 패키지 설치

```bash
pip install -r requirements.txt
```

### 2. 환경변수 설정

`.env` 파일을 생성하고 Railway 데이터베이스 URL을 설정하세요:

```env
DATABASE_URL=postgresql://username:password@host:port/database
```

또는 Railway 대시보드에서 환경변수를 직접 설정할 수 있습니다.

### 3. 스크립트 실행

```bash
python upload_corporation_overview.py
```

## 📊 CSV 파일 구조

업로드되는 CSV 파일은 다음과 같은 컬럼을 포함해야 합니다:

| 컬럼명 | 설명 | 데이터 타입 |
|--------|------|-------------|
| 종목코드 | 주식 종목 코드 | VARCHAR(20) |
| 종목명 | 회사명 | VARCHAR(200) |
| 주소 | 회사 주소 | TEXT |
| 설립일 | 회사 설립일 | DATE |
| 대표자 | 대표자명 | VARCHAR(200) |
| 전화번호 | 연락처 | VARCHAR(50) |
| 홈페이지 | 회사 웹사이트 | TEXT |

## 🗃️ 데이터베이스 테이블 구조

자동으로 생성되는 테이블 구조:

```sql
CREATE TABLE corporation_overview (
    id SERIAL PRIMARY KEY,
    종목코드 VARCHAR(20) UNIQUE NOT NULL,
    종목명 VARCHAR(200) NOT NULL,
    주소 TEXT,
    설립일 DATE,
    대표자 VARCHAR(200),
    전화번호 VARCHAR(50),
    홈페이지 TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 🔧 주요 기능

### 데이터 전처리
- 설립일 컬럼을 DATE 타입으로 자동 변환
- 빈 문자열을 NULL로 변환
- UTF-8 인코딩 지원

### 데이터베이스 관리
- 기존 데이터 확인 및 선택적 삭제
- 청크 단위 업로드로 메모리 효율성 향상
- 자동 인덱스 생성으로 검색 성능 최적화

### 오류 처리
- 파일 존재 여부 확인
- 데이터베이스 연결 상태 검증
- 상세한 오류 메시지 및 로그

## 📝 사용 예시

```bash
$ python upload_corporation_overview.py

🚀 기업개요 데이터 업로더 시작
✅ 파일 발견: document/dart/기업개요.csv

==================================================
🏢 기업개요 데이터 업로더
==================================================
📁 파일 경로: document/dart/기업개요.csv
🗃️ 테이블명: corporation_overview
🔑 기본키: 종목코드
📝 설명: 기업개요 정보
==================================================

계속 진행하시겠습니까? (y/N): y

🔌 데이터베이스 연결 시도 중...
✅ 환경변수에서 데이터베이스 URL을 가져왔습니다.
✅ 데이터베이스 연결 성공!
🏗️ 기업개요 테이블 생성 중...
✅ 기업개요 테이블 생성 완료!
📤 데이터 업로드 시작...
📊 CSV 파일 읽기 완료: 850개 행
📋 컬럼명:
  1. 종목코드
  2. 종목명
  3. 주소
  4. 설립일
  5. 대표자
  6. 전화번호
  7. 홈페이지
🔧 데이터 전처리 중...
💾 데이터베이스에 업로드 중...
📊 기존 데이터 수: 0개
✅ 데이터 업로드 완료!
📊 총 데이터 수: 850개

📋 샘플 데이터:
  - 95570 (AJ네트웍스)
  - 6840 (AK홀딩스)
  - 27410 (BGF)
  - 282330 (BGF리테일)
  - 138930 (BNK금융지주)

🎉 모든 작업이 완료되었습니다!
🔌 데이터베이스 연결 종료
```

## ⚠️ 주의사항

1. **데이터베이스 URL 보안**: `.env` 파일을 `.gitignore`에 추가하여 데이터베이스 접속 정보가 노출되지 않도록 하세요.

2. **백업**: 업로드 전에 기존 데이터를 백업하는 것을 권장합니다.

3. **권한**: 데이터베이스에 테이블 생성 및 데이터 삽입 권한이 있어야 합니다.

4. **파일 경로**: CSV 파일 경로가 올바른지 확인하세요.

## 🐛 문제 해결

### 일반적인 오류

1. **연결 오류**: DATABASE_URL이 올바른지 확인
2. **권한 오류**: 데이터베이스 사용자에게 적절한 권한 부여
3. **파일 오류**: CSV 파일 경로 및 인코딩 확인
4. **메모리 오류**: 대용량 파일의 경우 청크 크기 조정

### 로그 확인

스크립트는 상세한 로그를 제공하므로 오류 발생 시 로그를 확인하여 문제를 파악할 수 있습니다.

## 📞 지원

문제가 발생하거나 추가 기능이 필요한 경우 이슈를 등록해주세요.

